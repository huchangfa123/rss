<!-- Development -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="keywords" content="rss,feeder,订阅器,订阅,vue">
    <meta name="description" content="EnjoyRSS 是一个RSS订阅器">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0 user-scalable=no">
    <base href="/">
    <title>EnjoyRSS</title>
</head>
<body>
<div id="app" class="display:none"></div>
<script src="dist/build.js"></script>
<script src="//cdn.bootcss.com/mocha/3.2.0/mocha.min.js"></script>
<link href="//cdn.bootcss.com/mocha/3.2.0/mocha.min.css" rel="stylesheet">
<script src="//cdn.bootcss.com/chai/4.0.0-canary.1/chai.min.js"></script>
<div id="mocha"></div>
<script>
    if (window.initMochaPhantomJS && window.location.search.indexOf('skip') === -1) {
        initMochaPhantomJS()
    }
    mocha.ui('bdd');
    var expect = chai.expect;
    var should = chai.should();
    describe('Test Authenticate', function () {
        before(function(done) {
            vuex.commit('INPUT_EMAIL', 'test@test.com')
            vuex.commit('INPUT_PASSWORD', 'password')
            vuex.dispatch('register').then(function(res) {
                done()
            }).catch(function(err) {
                done()
            })
        });
        it('should console illegal email when entering a illegal email', function(done) {
            vuex.commit('INPUT_EMAIL', 'test')
            vuex.commit('INPUT_PASSWORD', 'password')
            vuex.dispatch('authenticate').then(function() {
                vuex.getters.error.should.equal('请输入正确的邮箱')
                done()
            })
        })
        it('should console illegal password when entering a illegal password', function(done) {
            vuex.commit('INPUT_EMAIL', 'test@test.com')
            vuex.commit('INPUT_PASSWORD', 'test')
            vuex.dispatch('authenticate').then(function() {
                vuex.getters.error.should.equal('密码不符合要求 /\\w{6,18}/')
                done()
            })
        })
        it('should login successfully when entering correct email and password', function(done) {
            vuex.commit('INPUT_EMAIL', 'test@test.com')
            vuex.commit('INPUT_PASSWORD', 'password')
            vuex.dispatch('authenticate').then(function() {
                vuex.getters.info.should.equal('欢迎回来')
                done()
            })
        })
        it('should console unregisted email when entering a unregisted email', function(done) {
            vuex.commit('INPUT_EMAIL', 'tessavasgast@test.com')
            vuex.commit('INPUT_PASSWORD', 'password')
            vuex.dispatch('authenticate').then(function() {
                vuex.getters.error.should.equal('邮箱未注册')
                done()
            })
        })
        it('should console wrong password when entering a registed email and a wrong password', function(done) {
            vuex.commit('INPUT_EMAIL', 'tessavasgast@test.com')
            vuex.commit('INPUT_PASSWORD', 'password')
            vuex.dispatch('authenticate').then(function() {
                vuex.getters.error.should.equal('密码错误')
                done()
            })
        })
    });
    mocha.run();
</script>
</body>
</html>